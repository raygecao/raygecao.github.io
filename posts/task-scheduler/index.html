<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=X-UA-Compatible content="IE=edge, chrome=1"><title>任务调度器重构 - 拾遗之途</title><meta name=Description content><meta property="og:title" content="任务调度器重构">
<meta property="og:description" content="为提升调度任务的规模，突破基于 etcd 存储状态进行调度的性能瓶颈，采用内存任务管理对调度器进行重构。"><meta property="og:type" content="article"><meta property="og:url" content="https://raygecao.github.io/posts/task-scheduler/"><meta property="og:image" content="https://raygecao.github.io/posts/task-scheduler/featured-image.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-27T10:48:10+08:00"><meta property="article:modified_time" content="2024-01-27T10:48:10+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://raygecao.github.io/posts/task-scheduler/featured-image.jpg"><meta name=twitter:title content="任务调度器重构"><meta name=twitter:description content="为提升调度任务的规模，突破基于 etcd 存储状态进行调度的性能瓶颈，采用内存任务管理对调度器进行重构。"><meta name=application-name content="拾遗之途"><meta name=apple-mobile-web-app-title content="拾遗之途"><meta name=google-site-verification content="OzXJ6LYRvjcbIN3W9Dn7TA7in9F1AYZjd2pciC8sexc"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://raygecao.github.io/posts/task-scheduler/><link rel=prev href=https://raygecao.github.io/posts/frontend-practice/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"任务调度器重构","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/raygecao.github.io\/posts\/task-scheduler\/"},"image":[{"@type":"ImageObject","url":"https:\/\/raygecao.github.io\/posts\/task-scheduler\/featured-image.jpg","width":2074,"height":624}],"genre":"posts","keywords":"platform","wordcount":3377,"url":"https:\/\/raygecao.github.io\/posts\/task-scheduler\/","datePublished":"2024-01-27T10:48:10+08:00","dateModified":"2024-01-27T10:48:10+08:00","publisher":{"@type":"Organization","name":"raygecao"},"author":{"@type":"Person","name":"raygecao"},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":""==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:""==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=拾遗之途>拾遗之途</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=拾遗之途>拾遗之途</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">任务调度器重构</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>raygecao</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/><i class="far fa-folder fa-fw"></i>工作记录</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2024-01-27>2024-01-27</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 3377 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 7 分钟&nbsp;<span id=/posts/task-scheduler/ class=leancloud_visitors data-flag-title=任务调度器重构>
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
</span>&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/posts/task-scheduler/featured-image.jpg data-srcset="/posts/task-scheduler/featured-image.jpg, /posts/task-scheduler/featured-image.jpg 1.5x, /posts/task-scheduler/featured-image.jpg 2x" data-sizes=auto alt=/posts/task-scheduler/featured-image.jpg title=/posts/task-scheduler/featured-image.jpg></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#背景>背景</a></li><li><a href=#原始任务调度器>原始任务调度器</a></li><li><a href=#重构目标>重构目标</a></li><li><a href=#重构实现>重构实现</a><ul><li><a href=#核心流程>核心流程</a></li><li><a href=#元数据与状态>元数据与状态</a></li><li><a href=#离线任务与在线任务>离线任务与在线任务</a></li><li><a href=#servant-facade>Servant Facade</a></li><li><a href=#故障转移>故障转移</a></li><li><a href=#调度一致性>调度一致性</a></li><li><a href=#高可用>高可用</a></li><li><a href=#崩溃恢复>崩溃恢复</a></li></ul></li><li><a href=#重构效果>重构效果</a></li></ul></nav></div></div><div class=content id=content><p>为提升调度任务的规模，突破基于 etcd 存储状态进行调度的性能瓶颈，采用内存任务管理对调度器进行重构。</p><h2 id=背景>背景</h2><p>任务调度器(Scheduler)是大规模业务系统的重要组成部分，其设计对系统的吞吐量、任务处理耗时、系统的稳定性等方面有着重要影响。</p><p>通常，Scheduler 需要考虑系统资源限制、任务优先级、任务抢占、调度公平性、调度延时等因素，需要针对不同业务系统作出权衡。</p><p>对于分布式任务调度系统来讲，还需要考虑高可用、调度数据一致性、崩溃恢复等问题。</p><p>我们的业务系统是图像识别系统，经历了如下发展阶段：</p><ul><li><strong>业务类型</strong>从最初的视频流人脸解析扩展到图片流人脸解析，扩展至基于视频流和图片流的人体、车辆解析，再扩展至脸人车绑定解析。</li><li><strong>接入规模</strong>从单机单卡16路视频流到单机一百路图片流接入，再到单机8卡千路图片流接入，又到集群万路图片流接入。</li><li><strong>业务场景</strong>从原始的在线视频流解析到离线视频流的解析，再到离线视频流切片解析。</li></ul><p>业务类型和规模的扩张要求我们对现有的 Scheduler 进行重构。</p><h2 id=原始任务调度器>原始任务调度器</h2><p>我们调度的维度主要是 GPU 资源。在最初任务量少，类型单一的场景下，为了使系统更轻量，我们采用了基于 etcd 的调度策略。之所以采用 etcd，是因为我们使用 etcd 用作服务发现及分布式选主，早期的目标是在<strong>不引入额外组件</strong>的前提下完成调度。</p><figure><a class=lightgallery href=/posts/task-scheduler/old-scheduler.png title=/posts/task-scheduler/old-scheduler.png data-thumbnail=/posts/task-scheduler/old-scheduler.png data-sub-html="<h2>原始任务调度架构</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=old-scheduler.png data-srcset="/posts/task-scheduler/old-scheduler.png, old-scheduler.png 1.5x, /posts/task-scheduler/old-scheduler.png 2x" data-sizes=auto alt=/posts/task-scheduler/old-scheduler.png height=400 width=800></a><figcaption class=image-caption>原始任务调度架构</figcaption></figure><p>具体策略如下：</p><ul><li>解析服务(Worker)在启动前，将其信息注册到 etcd 中，主要包含其所包含的GPU quota。</li><li>Worker 启动一个异步进程，通过 etcd <code>election.Campaign()</code> 选择一个主 Worker 执行调度程序。</li><li>调度程序定期从 etcd 中拉取 Worker 列表与任务列表进行比较，结合节点状态、任务状态对任务进行资源分配、任务转移等调度操作。</li><li>Worker 启动解析处理进程，定期从 etcd 中拉取分配给自身但未处理的任务进行处理，并对执行状态进行更新。</li></ul><p>整个调度过程与 Kube-scheduler Pod 调度方式有一些类似之处，但存在以下差别：</p><ul><li>Worker 与任务的获取均采用拉取全量的方式，未采用 watch 机制。</li><li>没有单独的调度组件，调度程序与解析程序在一个进程内。</li><li>缺少缓存机制与 patch 更新机制，状态更新都是更新完整结构到etcd中。</li></ul><p>随着接入路数规模扩大、解析类别增多，旧调度器的痛点突出，下面由重至轻列举一些：</p><ul><li>频繁的状态更新导致 etcd 性能大幅恶化，出现频繁的连接超时，影响到服务发现。</li><li>参与 campaign 的节点过多时，当 etcd 性能不稳定时会偶发选主卡住的问题。</li><li>调度的延时过大。</li><li>未考虑网络中断的问题，在 etcd 不稳定的情况下，调度结果不一致（资源超配、误扣、同一任务被多个 worker 执行）的问题频现。</li><li>调度代码难以维护且扩展性差，新类型解析任务出现时，不得不将调度核心逻辑拷一份进行修改，维护多份类似的代码。</li></ul><p>尽管期间我们通过很多方法缓解上述问题（如调整重试间隔，增加外部gc等），但随着路数进一步增加，系统性能明显变差，因此需要对任务调度架构进行重构。</p><h2 id=重构目标>重构目标</h2><p>为解决原有 Scheduler 的痛点，我们提出如下的重构目标：</p><ul><li>彻底缓解 etcd 压力，避免对选主、服务注册发现产生任何影响。</li><li>调度路数显著提升，支持百台服务器集群十万路图片流的调度。</li><li>Scheduler 自身的扩展性要大幅增强，新增解析类型时可以在零学习成本下接入。</li><li>Scheduler 高可用、崩溃恢复要得以保证。</li><li>Scheduler 与 Worker 的数据一致性得以保证，调度需满足业务场景需求（优先级、抢占、排队、重试等）。</li></ul><h2 id=重构实现>重构实现</h2><p>我们主要采用以下几种方式对 Scheduler 进行重构：</p><ul><li>任务元数据的存储从 etcd 转移到 postgresql 中以缓解 etcd 的压力。</li><li>Worker 元数据依然保留在 etcd 中，但通过 watch 机制获取全量结果并缓存在内存中。</li><li>状态数据仅维护在内存中。</li><li>Scheduler 改造成一个独立的微服务，通过 campaign 实现高可用。</li></ul><h3 id=核心流程>核心流程</h3><figure><a class=lightgallery href=/posts/task-scheduler/new-scheduler.png title=/posts/task-scheduler/new-scheduler.png data-thumbnail=/posts/task-scheduler/new-scheduler.png data-sub-html="<h2>重构调度架构</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=new-scheduler.png data-srcset="/posts/task-scheduler/new-scheduler.png, new-scheduler.png 1.5x, /posts/task-scheduler/new-scheduler.png 2x" data-sizes=auto alt=/posts/task-scheduler/new-scheduler.png height=400 width=800></a><figcaption class=image-caption>重构调度架构</figcaption></figure><ul><li>Worker 向 etcd 注册 GPU 资源及可处理任务的类型。</li><li>Scheduler 接收来自用户创建的任务，并将任务元数据进行落盘。</li><li>Scheduler 通过任务队列的方式在内存管理状态，找出所有未分配的任务，并结合 Worker 剩余资源进行调度，更新状态机产生相应的调度 action（如 Create/Delete）。</li><li>Scheduler 批量执行调度 action 以提升并发度。</li><li>Scheduler 定期向所有 Worker 发起心跳请求，一方面确认节点是否正常工作，另一方面获取分配到 Worker 上的任务状态以更新状态机。</li></ul><h3 id=元数据与状态>元数据与状态</h3><p>任务的数据结构可以分为元数据与状态：</p><ul><li>任务元数据：包括调度配置与任务处理配置，元数据需全部持久化。<ul><li>调度配置：如占用资源、任务类型、任务优先级、restartPolicy 等。</li><li>任务处理配置：如视频流/图片流的 url、告警阈值、布控范围等。</li></ul></li><li>任务状态：包括调度状态与处理状态，离线任务的状态需要持久化。<ul><li>调度状态：包括任务被分配的 Worker 标识以及对应的资源标识（如 GPU index）。</li><li>执行状态：任务当前的执行状态，包括 PENDING、RUNNING、SUCCESS、ERROR 等。</li></ul></li></ul><p>根据不同的任务执行状态，Scheduler 分别维护了 PENDING、RUNNING、ERROR 三个任务队列配合以下状态机实现任务调度与管理。</p><figure><a class=lightgallery href=/posts/task-scheduler/state-machine.png title=/posts/task-scheduler/state-machine.png data-thumbnail=/posts/task-scheduler/state-machine.png data-sub-html="<h2>任务执行状态机</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=state-machine.png data-srcset="/posts/task-scheduler/state-machine.png, state-machine.png 1.5x, /posts/task-scheduler/state-machine.png 2x" data-sizes=auto alt=/posts/task-scheduler/state-machine.png height=400 width=800></a><figcaption class=image-caption>任务执行状态机</figcaption></figure><h3 id=离线任务与在线任务>离线任务与在线任务</h3><p>根据业务需要，实时任务和离线任务处理存在如下差异：</p><ul><li>实时任务无法调整倍速，而离线任务可以调整倍速解析，倍速会映射到 GPU 资源占用上。</li><li>实时任务的优先级高于离线任务，实时任务可以抢占离线任务，离线任务无法抢占实时任务与离线任务。</li><li>实时任务支持暂停解析的功能，离线任务不支持暂停的功能，离线任务执行状态中 SUCCESS 与 ERROR 状态为终态，不会被重试拉起。</li><li>实时任务一旦失败后会被退避重新拉起。</li></ul><p>类比 K8s workload，离线任务相当于 Job，实时任务相当于 <code>restartPolicy=None</code> 的 Deployment。</p><h3 id=servant-facade>Servant Facade</h3><p>我们使用 Servant Facade 封装了复杂的任务管理流程，增强调度系统的可扩展性，便于接入新类型的任务。</p><p>每个 Worker 只需要传入 <code>runnerFactory</code> 到 Servant Facade 并注册到 GRPC Server 上即可实现对应的任务管理功能。</p><p>Servant Facade 主要封装了以下方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>AbstractServant</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// CreateTask 创建一个任务。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>CreateTask</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=o>*</span><span class=nx>CreateTaskRequest</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>Task</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// DeleteTask 删除一个任务。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>DeleteTask</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=o>*</span><span class=nx>DeleteTaskRequest</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>empty</span><span class=p>.</span><span class=nx>Empty</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// ListTaskStatus 列出所有task的status.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// Scheduler通过周期性调用该方法实现心跳及状态反馈。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>ListTaskStatus</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=o>*</span><span class=nx>ListTaskStatusRequest</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>ListTaskStatusResponse</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Register 注册 servant 处理的任务类型，其包含的 GPU 资源信息以及构建 runner 工厂方法。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>Register</span><span class=p>(</span><span class=nx>taskType</span> <span class=nx>TaskType</span><span class=p>,</span> <span class=nx>GPUResources</span> <span class=p>[]</span><span class=o>*</span><span class=nx>GPUResource</span><span class=p>,</span> <span class=nx>f</span> <span class=nx>RunnerFactoryFunc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Start 启动 runner 并接收请求。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>Start</span><span class=p>()</span> <span class=kt>error</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Servant Facade 相当于 Scheduler 向 Worker 进程中注入的 Sidecar，承接来自 Scheduler 的全部流量并将相应的任务 hook 到 runner 中。这解耦了 Worker 任务管理和任务执行的逻辑，对 Worker 开发者屏蔽了复杂的任务管理流程。</p><h3 id=故障转移>故障转移</h3><p>Scheduler 会通过 watch 的方式发现 Worker 节点的上下线，如果 Worker 因崩溃等原因使得注册到 etcd session 中断，Scheduler 会感知到 Worker 节点的下线，从而将分配到该节点的任务放入 ERROR 队列中等待重试。</p><p>如果 Worker 与 Scheduler 产生了网络分区，此时 etcd session 还在，调度节点无法通过服务发现感知到节点异常。这时 Scheduler 会通过连续几次心跳超时来将该 Worker 标记下线，该 Worker 上分配的任务放入 ERROR 队列里。 当某个节点连续多次分配任务失败时，逐步降低其调度权重，并在分配成功时恢复。</p><h3 id=调度一致性>调度一致性</h3><p>在分布式系统中，上述网络分区导致的故障转移会导致数据处理出现不一致的情况，最经典的是 At-Least-Once vs At-Most-Once。</p><ul><li>当出现网络分区导致 Scheduler 与 Worker 断连时，Scheduler 会将任务从该 Worker 中转移到其他 Worker 中。由于之前的 Worker 还正常工作，因此在此期间会出现<strong>重复解析</strong>(At-Least-Once)的情况。</li><li>同样的网络分区场景下，如果 Worker 也感知到与 Scheduler 断连（比如定期检查是否收到心跳），并在断连后停止所有正在处理的任务，这会由于以下两种情况而造成<strong>至多解析一次</strong>(At-Most-Once)：<ul><li>Worker 早于 Scheduler 感知到断连，因此在 Scheduler 重新调度任务前便终止了任务。</li><li>可用资源不够，导致部分任务无法被调度处理，这些任务会变成等待调度的状态。</li></ul></li></ul><p><strong>由于我们项目很多是单 Worker 现场，因此我们选择了 At-Least-Once 策略</strong>。该策略使得 Worker 仅需要被 Scheduler 驱动，简化了系统的复杂度。</p><p>无论是上述哪个策略，当 Worker 网络恢复后，调度结果总能恢复到 Exactly-Once 的情况。但由于 Runner 的设计是高度自由的，数据不一致仍然无法完全避免。
因此 Scheduler 会起一个异步 matcher 线程定期地对 Scheduler 维护的 RUNNING Queue 与 Worker 中收集到的任务列表进行比较，以对以下不一致的问题进行校正：</p><ul><li>某个任务在 Scheduler 中，但不在相应的 Worker 任务列表中。</li><li>某个任务不在 Scheduler 中，但在某个 Worker 任务列表中。</li><li>某个任务在多个 Worker 列表中出现。</li></ul><h3 id=高可用>高可用</h3><p>Scheduler 本身无状态，采用冷备方式通过 <code>election.Campaign</code> 进行故障切换。</p><h3 id=崩溃恢复>崩溃恢复</h3><p>Scheduler 重启/切主时会根据 postgresql 中存储的元数据恢复任务，并通过发起一次心跳收集各任务的分配状态及运行时状态，结合二者构建出任务队列完成恢复。</p><p>为保证恢复数据的一致性，恢复过程中无法接受新的请求。</p><h2 id=重构效果>重构效果</h2><ul><li>调度路数大幅提升，调度延时不随调度路数增加而显著增长，mock 测试调度 QPS 能达到十万量级。</li><li>etcd 后续未出现异常，解决计算节点（选主）过多时，依赖 etcd campaign 导致的选主卡住问题。</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2024-01-27</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/platform/>platform</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/frontend-practice/ class=prev rel=prev title=React前端快速构建><i class="fas fa-angle-left fa-fw"></i>React前端快速构建</a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><script type=text/javascript src=/lib/valine/Valine.min.js></script><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/algoliasearch/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{valine:{appId:"9CFga5qIsIai65AeVF4i0mAH-gzGzoHsz",appKey:"WgXjMQASwreiUmnY5dHWWx0Y",avatar:"mp",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!1,highlight:!0,lang:"zh-cn",pageSize:10,placeholder:"发表评论...",recordIP:!0,visitor:!0}},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},search:{algoliaAppID:"LX1FO3SR9Q",algoliaIndex:"blog",algoliaSearchKey:"e313cef40f53bf69fe7e593c2369a811",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>